{% extends "global/Page.html" %}
{% load otree %}

{% block title %}
タスク {{ round_number }} / {{ total_rounds }}
{% endblock %}

{% block content %}

<div class="card mb-3">
    <div class="card-body">
        <h5>タスクの説明</h5>
        <p>以下の0と1の数列の中から、次のパターン「<strong>{{ pattern_to_find }}</strong>」を見つけ出し、
        そのパターンをクリックして選択してください。</p>
        <p>正解の場合、{{ points_per_task }}ポイントを獲得できます。</p>
    </div>
</div>

<style>
    .binary-container {
        font-family: monospace;
        font-size: 16px;
        line-height: 1.5;
        word-wrap: break-word;
        user-select: none;
        cursor: pointer;
        padding: 15px;
        background-color: #f8f9fa;
        border-radius: 5px;
    }
    .binary-text {
        letter-spacing: 2px;
        display: inline-block;
    }
    .binary-char {
        display: inline-block;
        width: 12px;
        text-align: center;
    }
    .selected {
        background-color: #007bff;
        color: white;
        border-radius: 3px;
    }
</style>

<div class="card">
    <div class="card-body">
        <div class="binary-container" id="binaryDisplay">
            <div class="binary-text">
            {% for char in binary_string %}
                <span class="binary-char">{{ char }}</span>
            {% endfor %}
            </div>
        </div>
        
        {% formfield player.selected_sequence label="選択したパターン" %}
    </div>
</div>

<script>
    (function() {
        const patternLength = "{{ pattern_to_find }}".length;
        const binaryChars = document.querySelectorAll('.binary-char');
        const input = document.querySelector('input[name="selected_sequence"]');
        let startIndex = -1;

        function clearSelection() {
            binaryChars.forEach(char => char.classList.remove('selected'));
        }

        function updateSelection(index) {
            clearSelection();
            let sequence = '';
            for (let i = 0; i < patternLength && (index + i) < binaryChars.length; i++) {
                binaryChars[index + i].classList.add('selected');
                sequence += binaryChars[index + i].textContent;
            }
            input.value = sequence;
        }

        binaryChars.forEach((char, index) => {
            char.addEventListener('click', () => {
                startIndex = index;
                updateSelection(startIndex);
            });

            // ホバー効果を追加
            char.addEventListener('mouseenter', () => {
                if (startIndex === -1) {
                    updateSelection(index);
                }
            });
        });

        // 選択をリセットする機能を追加
        document.querySelector('.binary-container').addEventListener('mouseleave', () => {
            if (startIndex === -1) {
                clearSelection();
                input.value = '';
            }
        });
    })();
</script>

{% next_button %}

{% endblock %} 